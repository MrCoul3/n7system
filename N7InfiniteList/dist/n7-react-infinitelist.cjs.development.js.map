{"version":3,"file":"n7-react-infinitelist.cjs.development.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport _ from 'lodash';\n\ninterface IProps {\n  children?: string | React.ReactNode;\n  loadMore(dataLength: number): void;\n  countLimit: number | null;\n  dataLength: number;\n  minWidth?: string;\n  maxHeight?: string;\n}\n\nexport const InfiniteList = (props: IProps) => {\n  const dataLength = props.dataLength;\n  const wrap = useRef<HTMLDivElement>(null);\n  const [delta, setDelta] = useState<number>();\n\n  function useThrottle(cb: any, delay: number) {\n    const options = { leading: true, trailing: false };\n    const cbRef = useRef(cb);\n    useEffect(() => {\n      cbRef.current = cb;\n    });\n    return useCallback(\n      _.throttle((...args) => cbRef.current(...args), delay, options),\n      [delay]\n    );\n  }\n  const throttleLoadMore = useThrottle(() => props.loadMore(dataLength), 500);\n\n  useEffect(() => {\n    const wrapCurrent = wrap.current as HTMLDivElement;\n    setDelta(+wrapCurrent?.clientHeight - +wrapCurrent?.scrollHeight);\n  }, []);\n\n  useEffect(() => {\n    const wrapCurrent = wrap.current as HTMLDivElement;\n    if (\n      delta !== undefined &&\n      wrapCurrent?.clientHeight - wrapCurrent?.scrollHeight === 0 &&\n      dataLength !== 0\n    ) {\n      props.loadMore(dataLength);\n    }\n  }, [delta, props.dataLength]);\n\n  function handleScroll(e: React.UIEvent<HTMLElement>) {\n    const element = e.target as HTMLDivElement;\n    const countLimit = props.countLimit ? props.countLimit : 0;\n    let scrollBottom =\n      element.scrollHeight - element.offsetHeight - element.scrollTop;\n    if (dataLength < countLimit) {\n      if (Math.floor(scrollBottom) <= 0) {\n        throttleLoadMore();\n      }\n    }\n  }\n  return (\n    <div\n      ref={wrap}\n      onScroll={handleScroll}\n      style={{\n        minWidth: props.minWidth,\n        maxHeight: props.maxHeight,\n        overflowY: 'scroll',\n      }}\n    >\n      {props.children}\n    </div>\n  );\n};\n"],"names":["InfiniteList","props","dataLength","wrap","useRef","useState","delta","setDelta","useThrottle","cb","delay","options","leading","trailing","cbRef","useEffect","current","useCallback","_","throttle","throttleLoadMore","loadMore","wrapCurrent","clientHeight","scrollHeight","undefined","handleScroll","e","element","target","countLimit","scrollBottom","offsetHeight","scrollTop","Math","floor","React","ref","onScroll","style","minWidth","maxHeight","overflowY","children"],"mappings":";;;;;;;;;;IAYaA,YAAY,GAAG,SAAfA,YAAe,CAACC,KAAD;AAC1B,MAAMC,UAAU,GAAGD,KAAK,CAACC,UAAzB;AACA,MAAMC,IAAI,GAAGC,YAAM,CAAiB,IAAjB,CAAnB;;AACA,kBAA0BC,cAAQ,EAAlC;AAAA,MAAOC,KAAP;AAAA,MAAcC,QAAd;;AAEA,WAASC,WAAT,CAAqBC,EAArB,EAA8BC,KAA9B;AACE,QAAMC,OAAO,GAAG;AAAEC,MAAAA,OAAO,EAAE,IAAX;AAAiBC,MAAAA,QAAQ,EAAE;AAA3B,KAAhB;AACA,QAAMC,KAAK,GAAGV,YAAM,CAACK,EAAD,CAApB;AACAM,IAAAA,eAAS,CAAC;AACRD,MAAAA,KAAK,CAACE,OAAN,GAAgBP,EAAhB;AACD,KAFQ,CAAT;AAGA,WAAOQ,iBAAW,CAChBC,CAAC,CAACC,QAAF,CAAW;AAAA,aAAaL,KAAK,CAACE,OAAN,OAAAF,KAAK,YAAlB;AAAA,KAAX,EAAgDJ,KAAhD,EAAuDC,OAAvD,CADgB,EAEhB,CAACD,KAAD,CAFgB,CAAlB;AAID;;AACD,MAAMU,gBAAgB,GAAGZ,WAAW,CAAC;AAAA,WAAMP,KAAK,CAACoB,QAAN,CAAenB,UAAf,CAAN;AAAA,GAAD,EAAmC,GAAnC,CAApC;AAEAa,EAAAA,eAAS,CAAC;AACR,QAAMO,WAAW,GAAGnB,IAAI,CAACa,OAAzB;AACAT,IAAAA,QAAQ,CAAC,EAACe,WAAD,oBAACA,WAAW,CAAEC,YAAd,IAA6B,EAACD,WAAD,oBAACA,WAAW,CAAEE,YAAd,CAA9B,CAAR;AACD,GAHQ,EAGN,EAHM,CAAT;AAKAT,EAAAA,eAAS,CAAC;AACR,QAAMO,WAAW,GAAGnB,IAAI,CAACa,OAAzB;;AACA,QACEV,KAAK,KAAKmB,SAAV,IACA,CAAAH,WAAW,QAAX,YAAAA,WAAW,CAAEC,YAAb,KAA4BD,WAA5B,oBAA4BA,WAAW,CAAEE,YAAzC,MAA0D,CAD1D,IAEAtB,UAAU,KAAK,CAHjB,EAIE;AACAD,MAAAA,KAAK,CAACoB,QAAN,CAAenB,UAAf;AACD;AACF,GATQ,EASN,CAACI,KAAD,EAAQL,KAAK,CAACC,UAAd,CATM,CAAT;;AAWA,WAASwB,YAAT,CAAsBC,CAAtB;AACE,QAAMC,OAAO,GAAGD,CAAC,CAACE,MAAlB;AACA,QAAMC,UAAU,GAAG7B,KAAK,CAAC6B,UAAN,GAAmB7B,KAAK,CAAC6B,UAAzB,GAAsC,CAAzD;AACA,QAAIC,YAAY,GACdH,OAAO,CAACJ,YAAR,GAAuBI,OAAO,CAACI,YAA/B,GAA8CJ,OAAO,CAACK,SADxD;;AAEA,QAAI/B,UAAU,GAAG4B,UAAjB,EAA6B;AAC3B,UAAII,IAAI,CAACC,KAAL,CAAWJ,YAAX,KAA4B,CAAhC,EAAmC;AACjCX,QAAAA,gBAAgB;AACjB;AACF;AACF;;AACD,SACEgB,4BAAA,MAAA;AACEC,IAAAA,GAAG,EAAElC;AACLmC,IAAAA,QAAQ,EAAEZ;AACVa,IAAAA,KAAK,EAAE;AACLC,MAAAA,QAAQ,EAAEvC,KAAK,CAACuC,QADX;AAELC,MAAAA,SAAS,EAAExC,KAAK,CAACwC,SAFZ;AAGLC,MAAAA,SAAS,EAAE;AAHN;GAHT,EASGzC,KAAK,CAAC0C,QATT,CADF;AAaD;;;;"}